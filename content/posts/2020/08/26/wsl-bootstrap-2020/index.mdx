---
date: 2020-08-26
title: Windows Subsystem Linux Bootstrap 2020
tags: ['learning', 'guide', 'wsl']
private: true
---

Yo! It's that time again!!

This is an opinionated guide on setting up a development environment
for web development in widows that will use the requisite tools, Bash,
Node, Git, VSCode etc...

Tl;Dr to the [guide] if you're not interested in the preamble and how
I got here.

I've been using Manjaro (Linux distribution) for a grand total of
three months or so now; so now I've switched back to Windows üòÇ

> Why?
>
> Why not! üòú

I added another SSD to my PC so I have one with Linux and one with
Windows, I'm giving Windows a good roll because of things like the
XSplit VCam for a virtual camera background and OBS having Twitch
integration, not directly related to web dev but I like to create
content and the options in Windows are better than with Linux.

I have done a web development set up on Windows a couple of times in
the past:

- [Windows Subsystem Linux setup]
- [Windows Web-dev bootstrap]

This time round it was just as confusing (for me) at the times before,
so this is why I'm making notes for future Scott to refer to. üî•

## Advantages of Windows over Linux or MacOs

I'm not going to get into a debate on the advantages of one platform
over another.

I can be productive on all of them given the right tools and that's
fine with me. Consider it like building a project for a client, they
really don't care what framework you used to make it as long as it
works and I feel the same about that with using Windows, Linux or
MacOs.

## Why WSL?

So me saying that I do sound like a total hypocrite when what I am
using for web dev on Windows is, in fact, Linux!

Windows Subsystem Linux 2 to be precise, I was really excited for this
ever since seeing the announcement back in May 2019.

<Tweet tweetLink="windowsdev/status/1125484494616649728" />

> Dramatically improved file read performance up to a 3x improvement!

So what does WSL offer over using everything in Windows, I couldn't
say really, I think the developer experience (DX) in WSL offers a bit
more than that of Windows.

I have become a lot more accustomed to doing my web dev in a Linux
environment and I'm very comfortable using the terminal to get what
needs doing, done.

> If you already have a good set-up with Windows then there's no need
> to change, I'm not here to convince you otherwise.

## Prerequisites

I did this from a fresh install of Windows 10, I followed the
instructions from the [Windows WSL Install] docs.

You need to be on Windows version 1903 or higher, Build 18362 or
higher.

To check use the Windows run command Windows key + r (Win+r) and enter
`winver`, you'll get a dialogue with your machine details on it, I'm
on version 2004 build 19041.

## Install Ubuntu

Now is a good time to install [a Linux distro from the ms store] I'll
be using Ubuntu.

## Use PowerShell as admin

The next couple of things are getting the computer ready to run WSL,
open PowerShell as admin and enter some commands.

To open PowerShell as admin use Win+x then select Windows PowerShell
(Admin) or press a on the keyboard.

```powershell
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
```

Restart the machine.

## Check the features are on

Now is a good time to check the features were enabled, open the
Windows panel and search for 'Turn Windows features on or off' and
check in the dialogue windows that the 'Virtual Machine Platform' and
'Windows Subsystem for Linux' are checked.

Check that you can open Ubuntu, open it from the Windows start panel.

If there's a message along the lines of
`WSLRegisterDistribution failed with error: xxxx` (which is what I
got) then there's more information on enabling [some additional
features] for the WSL 2 kernel, run that.

Reboot again!

Check that you can open Ubuntu, again, it should start initialising.

> Installing, this may take a few minutes...

Open PowerShell, as admin again and check for available distros.

The `-l` is to list what you have installed and the `-v` flag is for
verbose, I thought it was the WSL version (1 or 2). ü§∑‚Äç‚ôÄÔ∏è

```powershell
wsl -l -v
```

Once Ubuntu has finished installing you're prompted to add a user and
password.

You're good to go!

I like to update any packages that may need upgrading, I use the
following snippet to do that:

```bash
sudo apt update && sudo apt upgrade -y && sudo apt autoremove -y
```

The `-y` flag is to confirm 'yes I want to update' if you want to take
a look before letting it do it's thing then remove the `-y` flags.

## Enable file permissions for symlinks

This will only come into play if you want to have your configuration
files for things like `.gitconfig` and `.ssh` in a shared location.

This allows file permissions to be persisted see this [great
explanation from Brian Turek] detailing it.

I followed the documentation on the Microsoft docs to [configure per
distro launch settings with `wsl.conf`], my `wsl.conf` file looks like
this:

```bash
# Enable extra metadata options by default
[automount]
enabled = true
root = /windir/
options = "metadata,umask=22,fmask=11"
mountFsTab = false
```

You probably only need:

```bash
[automount]
enabled = true
options = "metadata,umask=22,fmask=11"
```

With the first options I now have my root directory changed to
`/windir/` instead of the default `/mnt/`. Partly my fault for blindly
following instructions on the internet!

There's more detail on what the `[automount]` options are in this post
on [RIDICURIOUS].

You can edit the `wsl.conf` with:

```bash
nano /etc/wsl.conf
```

## Chocolatey

Now it's time for me to start adding programs for use on my Windows
machine, this is a fresh install so all I have installed is the
preinstalled app that come with the installation media I created via
the Windows media creation tool.

Anyways, to keep my packages in order I'm using [Chocolatey] the
package manager for Windows.

Install for Chocolatey was again via an admin level PowerShell, the
instructions can be found on the site under [Get Started].

From the Chocolatey docs:

Run `Get-ExecutionPolicy`. If it returns `Restricted`, then run
`Set-ExecutionPolicy AllSigned` or
`Set-ExecutionPolicy Bypass -Scope Process`

Which I did, then I run this:

```powershell
Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))
```

So for me there are a few programs I need:

- 7zip
- bitwarden
- discord
- firefox-dev
- hwmonitor
- hyper
- licecap
- microsoft-edge-insider
- obs-studio
- vlc
- vscode
- WSLGit

To get that list I used this PowerShell command to list what I have
installed:

```powershell
choco list --local-only
# or
clist -l
```

The only ones on there to take note of really that are used for web
dev are VSCode and **WSLGit**.

WSLGit being the important one that enables the use of Git installed
on your WSL instance to work in VSCode on Windows.

Prior to this I [had to install Git on Windows] which had it's own set
of problems with line endings and file permissions.

Installing this via Chocolatey I haven't had any issues, it's a
straight up install from Chocolatey and forget about it, works pretty
well so for.

## Make it your own

Time to add all the web dev tools you need, for me this is Node, Yarn,
NVM and my shell of choice Fish with Oh My Fish.

Install the `build-essential` tools for utility packages like `make`
this will come in handy when installing node.

```bash
sudo apt install -y build-essential
```

## Terminal

I like [Hyper], but I've decided to use the [Microsoft Terminal] for a
while, so far I really like it.

Once I found out how to customise it via the [Windows Terminal
documentation] and found a pretty sweet site for [Windows Terminal
Themes].

## Shell

My preferred shell is Fish, I love this for it's auto completion and
path matching also, with Oh My Fish you get added themes and support
for NVM and other things.

Install Fish via the Ubuntu package manager:

```bash
sudo install fish
```

Then install OMF with a `curl` command:

```bash
curl -L https://get.oh-my.fish | fish
```

This will switch me into the Fish shell once it's finished then I can
install a super sweet theme from OMF, to list out the available themes
in OMF:

```bash
omf theme
```

I like the `one` theme as it gives Git and node version information,
I'll install it with:

```bash
omf install one
```

I'm also going to need the NVM wrapper package for Fish:

```bash
omf install nvm
```

## Change default shell

## Node with NVM

This time round I'm [using Node Version Manager] (NVM) in place of `n`
as `n` has a weird bug where it doesn't change past Node v10.

NVM is installed with a one liner:

```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash
```

Then install node set it for use and default it to v12 long term
support (LTS) version.

```bash
nvm install 12 && nvm use 12 && nvm alias default 12
```

There's other Node version manager out there if you want to give them
a try:

- [n]
- [fnm]
- [Volta]
- [asdf-vm]
- [nvs]

For fnm you may need `unzip` for if not installed already:

```bash
sudo apt innstall unzip
```

I've also installed [fnm] as it also works with `.nvmrc` and
`.node-version`.

## Yarn

I prefer to use Yarn in my projects over npm, one for Yarn workspaces
but also because the script syntax is that little bit shorter:

```bash
npm run develop
# vs
yarn develop
```

Yes lazy dev is lazy! I'll install Yarn with the Ubuntu package
manager:

```bash
sudo apt install yarn
```

## Hub

[Hub] offers some extended command line features for GitHub, such as
making PRs and being able to pop open the repo in a browser window.

Install hub via the Ubuntu package manager:

```bash
sudo apt install hub
```

## Symlinks (Symbolic Link)

A quick note on symlinks ([symbolic links]), and why I'm using them.
So a symlink is a pointer to a file somewhere else, an example would
be in Windows when you install a program you get a shortcut on your
desktop to that program, a symlink is like that.

The reasoning for using them is with WSL you can have several several
instances of a Linux distro on your machine.

There's several for Ubuntu, with Ubuntu (20.04), Ubuntu 20.04 LTS and
Ubuntu 18.04 LTS then on top of that there are [another several
distros] recommended by Microsoft with additional ones on top of that
like [Pengwin] (which is a great extension on what's already available
in the recommended distros from Microsoft).

**What does that have to do with symlinks though?** Well, if you think
about each one of these instances you could have each their own
isolated oppearting system on your machine.

Each one with it's own set of configurations, it will get pretty
tedious keeping them all current.

The majority of my settings on these instances will be for git,
`.gitconfig` and SSH settings for [authenticating with GitHub via
SSH].

Rather than have several differing SSH keys I have the one key in a
shared location for all the WSL instances that need to use it.

## Hints and tips

Use Yarn? Don't seem to be able to use `yarn` in the terminal? Try
adding [this line] to your `.bashrc` file:

```bash
# open the .bashrc file to edit with nano
nano ~/.bashrc
# add the following line at the bottom of the file
export PATH="$(yarn global bin):$PATH"
# ctrl+o to write the change
# ctrl+x to exit
# reload the terminal with
source ~/.bashrc
```

<!-- Links -->

[windows subsystem linux setup]:
  https://scottspence.com/2018/01/13/wsl-bootstrap/
[windows web-dev bootstrap]:
  https://scottspence.com/2018/12/24/wsl-bootstrap-2019/
[slow]:
  https://github.com/microsoft/WSL/issues/5078#issuecomment-613384302
[symbolic links]: https://en.wikipedia.org/wiki/Symbolic_link
[a linux distro from the ms store]: https://aka.ms/wslstore
[pengwin]: https://www.whitewaterfoundry.com/
[rook]:
  https://nickymeuleman.netlify.app/blog/linux-on-windows-wsl2-zsh-docker
[authenticating with github via ssh]:
  https://cheatsheets.xyz/git/#how-to-authenticate-with-github-using-ssh
[cygwin]: https://cygwin.com/packages/summary/bash.html
[chocolatey]: chocolatey.org/
[guide]: #prerequisites
[windows terminal documentation]:
  https://github.com/microsoft/terminal/blob/master/doc/user-docs/UsingJsonSettings.md
[windows terminal themes]: https://atomcorp.github.io/themes/
[guide on how to use themes]:
  https://github.com/atomcorp/themes#how-to-use-the-themes
[wsl git workaround]: https://github.com/Microsoft/vscode/issues/9502
[this line]:
  https://github.com/yarnpkg/yarn/issues/5353#issuecomment-593307861
[windows wsl install]:
  https://docs.microsoft.com/en-us/windows/wsl/install-win10
[some additional features]: https://aka.ms/wsl2kernel
[great explanation from brian turek]:
  https://www.turek.dev/post/fix-wsl-file-permissions/
[configure per distro launch settings with `wsl.conf`]:
  https://docs.microsoft.com/en-us/windows/wsl/wsl-config#configure-per-distro-launch-settings-with-wslconf
[ridicurious]:
  https://ridicurious.com/2019/07/25/setup-wsl-launch-configuration-wsl-conf/
[chocolatey]: https://chocolatey.org/
[get started]: https://chocolatey.org/install
[had to install git on windows]:
  https://scottspence.com/2018/12/24/wsl-bootstrap-2019/#install-windows-git
[using node version manager]: https://github.com/nvm-sh/nvm
[n]: https://www.npmjs.com/package/n#installation
[fnm]: https://github.com/Schniz/fnm#using-a-script
[volta]: https://github.com/volta-cli/volta#installing-volta
[asdf-vm]: https://asdf-vm.com/#/core-manage-asdf-vm
[nvs]: https://github.com/jasongin/nvs
[hub]: https://github.com/github/hub
[hyper]: https://hyper.is/
[microsoft terminal]: https://aka.ms/terminal
