---
date: 2020-06-04
title: Linaria CSS - Getting Started
tags: ['getting started', 'hello world', 'css', 'css-in-js']
private: false
---

I had a work colleague introduce me to Linaria last week and I've used
it on a project and I quite like it.

Linaria is like styled-components but different as in there's no
runtime cost and some other gotchas I've found along the way.

What does that mean though? I'm going to take the headings from the
[Linaria Docs for benefits] and list them here, for more detail on
them I suggest checking the links in the list.

## Advantages Over other CSS-in-JS solutions

1. [CSS is downloaded and parsed separately from JS]
1. [No extra parsing needed for CSS]
1. [No style duplication on SSR]
1. [Catch errors early due to build-time evaluation]
1. [Familiar CSS syntax]
1. [Works without JavaScript]

## Example Me Up Yo!

Getting started with Linaria, I'm using the Gatsby default starter (no
surprises there I guess ðŸ¤£).

I like styled-components because you're writing CSS not camelCase
style keys.

To start I'll spin up a new project with the Gatsby CLI:

```bash
# with the Gatsby CLI
gatsby new gatsby-starter-linaria
# or with npx
npx gatsby new gatsby-starter-linaria
```

Add Linaria and the Gatsby plugin as dependencies:

```bash
yarn add linaria@next gatsby-plugin-linaria
```

> Error: Cannot find module 'core-js/modules/'

I'm using `@next` because there's a [known issue] between Linaria and
Gatsby's version of core-js.

Add `gatsby-plugin-linaria` to the `gatsby-config.js` file in the
`plugins` array:

```js
plugins: [
  `gatsby-plugin-linaria`,
  `gatsby-plugin-react-helmet`,
  {
    resolve: `gatsby-source-filesystem`,
    ...
```

The `...` represents the reset of the items in the array, it's
shortend for [brevity].

Delete the `layout.css` file in the components directory and remove
the `import "./layout.css"` from the `layout.js` component.

Now the reset is removed (when I deleted the `layout.css` file)
there's a bit of a boarder and everything looks a bit meh!

## Global Style

With CSS-in-JS the styles can be scoped to specific components, more
on this in a bit.

Sometimes there's a need to write some global styles, to get rid of
that border margin and to normalise browser inconsistencies.

I'll straight up [jack the example] given in the Linaria docs and add
that to a `theme` folder in the `src` directory, file structure will
look like this.

```text
gatsby-starter-linaria/
â”œâ”€ src/
â”‚  â”œâ”€ components
â”‚  â”œâ”€ images
â”‚  â”œâ”€ pages
â”‚  â””â”€ theme
â”‚     â””â”€ globals.js
```

In the `globals.js` file, I'll import the `css` tag from Linaria.

```js
import { css } from 'linaria'

export const globals = css`
  :global() {
    html {
      box-sizing: border-box;
    }

    *,
    *:before,
    *:after {
      box-sizing: inherit;
    }

    body {
      background: red;
      margin: 0;
    }
  }
`
```

Ok, cool, so that's nice, but where tf do I do with it? Right??

So, from what I can glean the `css` tag will append the global style
to the `body` element of the project no matter where you put it. ðŸ™ƒ

For me it'll make sense to add it to the `layout` component as this is
where all the main styles for this project live and it's what wraps
every other component and page in the project.

For now I'll change the empty fragment (`<></>`) wrapping the layout
component to a div and add a `className` to it to pass the `globals`
to:

```jsx {2}
...
import { globals } from "../theme/globals"
...

return (
  <div className={globals}>
    <Header siteTitle={data.site.siteMetadata.title} />
    <div
      style={{
        margin: `0 auto`,
        maxWidth: 960,
        padding: `0 1.0875rem 1.45rem`,
      }}
    >
      <main>{children}</main>
      ...
```

I can now take some of the styles from the reset I deleted and add
those to the `globals` file:

```js {6-8,19-20}
import { css } from 'linaria'

export const globals = css`
  :global() {
    html {
      box-sizing: border-box;
      font-family: sans-serif;
      -ms-text-size-adjust: 100%;
      -webkit-text-size-adjust: 100%;
    }

    *,
    *:before,
    *:after {
      box-sizing: inherit;
    }

    body {
      margin: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  }
`
```

Styles are back to what they were but I'm now using Linaria.

## Using the `styled` tag

Now I can use the Linaria `styled` tag much in the same way I'd use it
with styled-components, so I'm going to convert the components from
using the inline `style` tag.

I'll work through the components first then the pages.

**Header** import the Linaria `styled` tag and make a `StyledHeader`
component:

```js
import { styled } from 'linaria/react'

const StyledHeader = styled.header``
```

From here I can add all the styles in that wrapping component, a `div`
a `h1` and an `a` tag (the Gatsby `Link` component) like this:

```js
const StyledHeader = styled.header`
  background: rebeccapurple;
  margin-bottom: 1.45rem;
  div {
    margin: 0 auto;
    max-width: 960px;
    padding: 1.45rem 1.0875rem;
  }
  h1 {
    margin: 0;
  }
  a {
    color: white;
    text-decoration: none;
  }
`
```

Now the component is cleaner with all the inline styling removed.

```jsx
const Header = ({ siteTitle }) => (
  <StyledHeader>
    <div>
      <h1 style={{ margin: 0 }}>
        <Link to="/">{siteTitle}</Link>
      </h1>
    </div>
  </StyledHeader>
)
```

**Layout** same again, import the Linaria `styled` tag and make a
`StyledLayout` component:

```js
import { styled } from 'linaria/react'

const StyledLayout = styled.main``
```

As this is wrapping the whole project I'll need to define a class for
the `div` on this component:

```js
const StyledLayout = styled.main`
  .page-wrapper {
    margin: 0 auto;
    max-width: 960px;
    padding: 0 1.0875rem 1.45rem;
  }
`
```

And apply the class to the div in the component:

```jsx
return (
  <StyledLayout className={globals}>
    <Header siteTitle={data.site.siteMetadata.title} />
    <div className="page-wrapper">
      <>{children}</>
      <footer>
        Â© {new Date().getFullYear()}, Built with
        {` `}
        <a href="https://www.gatsbyjs.org">Gatsby</a>
      </footer>
    </div>
  </StyledLayout>
)
```

## Theming

You can create your own theme with Linaria using React Context but I

have decided to go with the Callstack theme provider. You can
implement it like so:

```js
import { createTheming } from '@callstack/react-theme-provider'
import { defaults } from './default-config'

const theme = {
  ...defaults,
}

export const { ThemeProvider, withTheme, useTheme } = createTheming(
  theme
)
```

In this example I'm spreading in the [defaults from Tailwind CSS] this
means I have all the defaults available in Tailwind from the
ThemeProvider.

## Global styling

Linaria uses the `css` helper for global styles, but the documentation
doesn't really show you how to implement it over, "this is how you
make a global style", I found that you can append it to the
`ThemeProvider` class like so:

```jsx
<ThemeProvider theme={theme} className={globals}>
  <>{element}</>
</ThemeProvider>
```

## Theme hook

To use the theme I've utilised the `useTheme` hook provided by the
theme provider.

```jsx
import { styled } from 'linaria/react'
import React from 'react'
import { useTheme } from '../../theme/theme-provider'

const StyledText = styled.h3`
  font-size: ${({ theme }) => theme.fontSize['2xl']};
  font-family: ${({ theme }) => theme.fontFamily.serif};
  margin-top: ${({ theme }) => theme.spacing[8]};
  line-height: ${({ theme }) => theme.lineHeight.none};
`

export const H3 = props => {
  const theme = useTheme()
  return (
    <StyledText theme={theme} {...props}>
      {props.children}
    </StyledText>
  )
}
```

## Convert Default Starter to Linaria

```bash
yarn add gatsby-plugin-linaria linaria
```

Add the Linaria Gatsby plugin to the plugin array, add
`.linaria-cache` to the `.gitignore` file.

Remove current styling which is the `layout.css` file in the
components folder along with the inline styles.

Add global styles

Resources:

- [The unseen performance costs of modern CSS-in-JS libraries in React
  apps]
- [CSS-in-JS Performance Cost - Mitigating Strategies]

<!-- Links -->

[the unseen performance costs of modern css-in-js libraries in react apps]:
  https://calendar.perfplanet.com/2019/the-unseen-performance-costs-of-css-in-js-in-react-apps/
[defaults from tailwind css]:
  https://github.com/tailwindcss/designing-with-tailwindcss/blob/master/01-getting-up-and-running/07-customizing-your-design-system/tailwind-full.config.js
[css-in-js performance cost - mitigating strategies]:
  https://www.infoq.com/news/2020/01/css-cssinjs-performance-cost/
[https://www.freecodecamp.org/news/the-tradeoffs-of-css-in-js-bee5cf926fdb/]:
  https://www.freecodecamp.org/news/the-tradeoffs-of-css-in-js-bee5cf926fdb/
[linaria docs for benefits]:
  https://github.com/callstack/linaria/blob/master/docs/BENEFITS.md
[css is downloaded and parsed separately from js]:
  https://github.com/callstack/linaria/blob/master/docs/BENEFITS.md#1-css-is-downloaded-and-parsed-separately-from-js
[no extra parsing needed for css]:
  https://github.com/callstack/linaria/blob/master/docs/BENEFITS.md#2-no-extra-parsing-needed-for-css
[no style duplication on ssr]:
  https://github.com/callstack/linaria/blob/master/docs/BENEFITS.md#3-no-style-duplication-on-ssr
[catch errors early due to build-time evaluation]:
  https://github.com/callstack/linaria/blob/master/docs/BENEFITS.md#4-catch-errors-early-due-to-build-time-evaluation
[familiar css syntax]:
  https://github.com/callstack/linaria/blob/master/docs/BENEFITS.md#5-familiar-css-syntax
[works without javascript]:
  https://github.com/callstack/linaria/blob/master/docs/BENEFITS.md#6-works-without-javascript
[jack the example]:
  https://github.com/callstack/linaria/blob/master/docs/BASICS.md#adding-global-styles
[brevity]: https://dictionary.cambridge.org/dictionary/english/brevity
[known issue]:
  https://github.com/silvenon/gatsby-plugin-linaria#error-cannot-find-module-core-jsmodulespolyfill
